# About Part IV

![immg](assets/efcore_csharp.png)

In this branch

:heavy_check_mark: Grouping data.

Grouping is one of the most powerful capabilities of LINQ. The following examples show how to group data in various ways:

- By a single property.
- By the first letter of a string property.
- By a computed numeric range.
- By Boolean predicate or other expression.
- By a compound key.

## Lessons

Working with `NorthWind` database ([script](https://gist.github.com/karenpayneoregon/40a6e1158ff29819286a39b7f1ed1ae8) found here)

:heavy_check_mark: One property [GroupBy](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.groupby?view=net-5.0)

:heavy_check_mark: Complex multiple property [GroupBy](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.groupby?view=net-5.0) with [Projections](https://github.com/karenpayneoregon/ef-core-lessons-csharp/tree/Part5_InMemory/NorthWindCoreLibrary/Projections)

:heavy_check_mark: In-memory unit testing EF Core 5

## View EF queries

Microsoft docs [Simple logging and improved diagnostics](https://docs.microsoft.com/en-us/ef/core/what-is-new/ef-core-5.0/whatsnew#simple-logging-and-improved-diagnostics)

**Debug View**

For use this, you're going to want to set a breakpoint below your EF Core query.

Once the breakpoint is hit hover over query to expand then click on > Debug View > The dropdown beside the magnifying glass> Text Visualizer.

There you have it, the SQL that will be sent to the database.

**ToQueryString() Method**

For this, you'll want to create a variable using the query.ToQueryString() method. Then you can do write it to the console.

Now you'll be able to view the SQL generated by entity framework core

**Logging with LogTo()**


The first two options don't scale well, that's where LogTo() comes in. Here's a way that you can log the SQL generated from EF Core 5.

Add the method LogTo() where you've configured Entity Framework Core. It takes an action and a logging level. Here I'm just writing it to the console and setting the log level to Information




| Note  |
| :--- |
| There are several different ways to perform testing, see [Testing code that uses EF Core](https://docs.microsoft.com/en-us/ef/core/testing/) |
| :warning: The EF in-memory database often behaves differently than relational databases. Only use the EF in-memory database after fully understanding the issues and trade-offs involved, as discussed in [Testing code that uses EF Core](https://docs.microsoft.com/en-us/ef/core/testing/).|


:heavy_check_mark: [FindAllAsync](https://github.com/karenpayneoregon/ef-core-lessons-csharp/blob/Part5_InMemory/NorthWindCoreLibrary/LanguageExtensions/EntityHelpers.cs#L20)

| Multiple key find  |
| :--- |
| To find a record by primary key, many developers will use .[Where](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=net-5.0) or .[FirstOrDefault](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.firstordefault?view=net-5.0). Better to use .[Find](https://docs.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.dbcontext.find?view=efcore-5.0) while to find multiple records [FindAllAsync](FindAllAsync) is a better choice. |
| **Find**</br> an entity with the given primary key values. If an entity with the given primary key values is being tracked by the context, then it is returned immediately without making a request to the database. Otherwise, a query is made to the database for an entity with the given primary key values and this entity, if found, is attached to the context and returned. If no entity is found, then null is returned. |

:heavy_check_mark: [Interceptors](https://docs.microsoft.com/en-us/ef/core/logging-events-diagnostics/interceptors)

| Interceptors  |
| :--- |
| Entity Framework Core (EF Core) interceptors enable interception, modification, and/or suppression of EF Core operations. This includes low-level database operations such as executing a command, as well as higher-level operations, such as calls to SaveChanges.|
| Interceptors are different from logging and diagnostics in that they allow modification or suppression of the operation being intercepted. Simple logging or Microsoft.Extensions.Logging are better choices for logging.|
| Interceptors are registered per DbContext instance when the context is configured. Use a diagnostic listener to get the same information but for all DbContext instances in the process.|
| |

# Microsoft

- [Entity Framework Core](https://docs.microsoft.com/en-us/ef/core/)
- [Compare EF Core & EF6](https://docs.microsoft.com/en-us/ef/efcore-and-ef6/)
- [What's New in EF Core 5.0](https://docs.microsoft.com/en-us/ef/core/what-is-new/ef-core-5.0/whatsnew)
- [Razor Pages with Entity Framework Core in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/data/ef-rp/intro?view=aspnetcore-5.0&tabs=visual-studio) (1 of 8)
- [EF Core 5 samples](https://github.com/dotnet/EntityFramework.Docs/tree/main/samples/core)
- [Query Expression Syntax Examples: Grouping](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/ef/language-reference/query-expression-syntax-examples-grouping)
- [Entity Framework Core tools reference - Package Manager Console in Visual Studio](https://docs.microsoft.com/en-us/ef/core/cli/powershell)
- [Entity Framework Core shadow properties](https://social.technet.microsoft.com/wiki/contents/articles/53662.entity-framework-core-shadow-properties-c.aspx)
- [HasValueGenerator](https://social.technet.microsoft.com/wiki/contents/articles/53858.entity-framework-core-hasvaluegenerator-using-c.aspx) 
- [Global Query Filters](https://social.technet.microsoft.com/wiki/contents/articles/53834.entity-framework-core-3-x-global-query-filters-c.aspx)
- [Entity Framework database/Code First Enum support](https://social.technet.microsoft.com/wiki/contents/articles/53169.entity-framework-databasecode-first-enum-support.aspx)
- [EntityFrameworkCore.VisualBasic](https://github.com/efcore/EFCore.VisualBasic)
  - [Code sample](https://github.com/karenpayneoregon/efcore-vbnet-scaffolding) (Karen Payne repo)

# Other resources

- [EntityFramework.Exceptions](https://github.com/Giorgi/EntityFramework.Exceptions)
- [Entity Framework Core 3x/5 soft deletables](https://github.com/karenpayneoregon/ef-core-soft-delete)





## Notes

- There are many different types of group-by operations to consider, here are a few.
- The complex example is one that many developer struggle with which is why it's included.

:yellow_circle: Extra - DBContext connection via environment variable

## Unit testing

![img](assets/oops.png)